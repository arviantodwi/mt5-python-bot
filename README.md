# MT5 Python Bot

This project is a Python-based trading bot that connects to the MetaTrader 5 (MT5) platform. It is designed to automate trading strategies, retrieve real-time market data, and execute trades based on a predefined set of rules.

## Table of Contents

- [Features](#features)
- [Project Structure](#project-structure)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Setup](#setup)
  - [Configuration](#configuration)
- [Usage](#usage)
  - [Running the Bot](#running-the-bot)
- [Logging](#logging)
- [Deployment](#deployment)
- [Development](#development)
  - [Core Components](#core-components)
  - [Strategy](#strategy)

## Features

- **Automated Trading:** Executes trades automatically based on a defined strategy.
- **Real-Time Market Data:** Retrieves live price data from MT5.
- **Risk Management:** Calculates position sizes based on a configurable risk percentage.
- **Session Management:** Operates within a defined trading session window.
- **Continuous Deployment:** Automatically deploys the latest version of the bot to a self-hosted server.

## Project Structure

The project is organized as follows:

```
.
├── .github/workflows/deploy.yml  # GitHub Actions workflow for CI/CD
├── app/                          # Core application source code
│   ├── adapters/                 # Adapters for external services (e.g., MT5)
│   ├── config/                   # Configuration management
│   ├── domain/                   # Core domain logic and models
│   ├── infra/                    # Infrastructure services (e.g., logging, clock)
│   └── services/                 # Business logic and services
├── logs/                         # Log files generated by the bot
├── .env.example                  # Example environment file
├── main.py                       # Main entry point of the application
├── requirements.txt              # Python dependencies
└── start.bat                     # Batch script to run the bot in a production environment
```

## Getting Started

### Prerequisites

- Windows (due to MetaTrader 5 terminal dependency)
- Python 3.13
- MetaTrader 5 Terminal
- A valid MT5 trading account

### Setup

1.  **Clone the repository:**

    ```bash
    git clone https://github.com/your-username/mt5-python-bot.git
    cd mt5-python-bot
    ```

2.  **Create a virtual environment:**

    It is recommended to use a virtual environment to manage the project's dependencies.

    ```bash
    python -m venv venv
    ```

3.  **Activate the virtual environment:**

    - **Windows**:
      ```bash
      .\venv\Scripts\activate
      ```
      <!-- - **macOS/Linux:**
        ```bash
        source venv/bin/activate
        ``` -->

4.  **Install the required packages:**

    Install the dependencies listed in the `requirements.txt` file using pip.

    ```bash
    pip install -r requirements.txt
    ```

### Configuration

The bot is configured using environment variables. Create a `.env` file in the root of the project by copying the `.env.example` file.

```bash
copy .env.example .env
```

Update the `.env` file with your MT5 account credentials and desired trading parameters.

| Variable        | Description                                                     |
| --------------- | --------------------------------------------------------------- |
| `TERMINAL_PATH` | Path to the MetaTrader 5 terminal executable.                   |
| `ACCOUNT_USER`  | Your MT5 account login ID.                                      |
| `ACCOUNT_PASS`  | Your MT5 account password.                                      |
| `SERVER_ID`     | The trading server to connect to.                               |
| `SYMBOL`        | The trading symbol for the bot to monitor (e.g., `EURUSD`).     |
| `TIMEFRAME`     | The candlestick timeframe in minutes (e.g., `5` for 5 minutes). |
| ...             | See `.env.example` for all available options.                   |

## Usage

### Running the Bot

To start the bot, run the `main.py` script from the root of the project.

```bash
python main.py
```

The bot will initialize, connect to the MT5 terminal, and start monitoring the market for trading opportunities based on the configured strategy.

The `start.bat` script is intended for running the bot as a service in a production environment. It activates the virtual environment and starts the bot.

## Logging

The bot generates detailed logs that are stored in the `logs/` directory. The log level can be configured in the `.env` file. The logs are useful for monitoring the bot's activity and troubleshooting any issues.

## Deployment

The project includes a GitHub Actions workflow for continuous deployment, defined in `.github/workflows/deploy.yml`. This workflow automates the process of deploying the bot to a self-hosted Windows server.

The workflow is triggered on pushes to the `main` branch and performs the following steps:

1.  **Build:**
    - Checks out the repository.
    - Sets up Python and installs dependencies.
    - Packages the application files into an artifact.
2.  **Deploy:**
    - Downloads the artifact to the self-hosted runner.
    - Stops the running service, deploys the new files, updates the virtual environment, and restarts the service.

## Development

### Core Components

- **`main.py`**: The entry point of the application. It initializes and runs the bot.
- **`app/bootstrap.py`**: Handles the initialization of all services and dependencies.
- **`app/services/`**: Contains the core business logic of the bot.
  - `CandleMonitorService`: Monitors for new candles and orchestrates the trading logic.
  - `SignalService`: Detects trading signals based on the strategy.
  - `ExecutionService`: Executes trades and manages orders.
  - `RiskService`: Calculates the appropriate position size for each trade.
- **`app/adapters/mt5_client.py`**: A wrapper around the `MetaTrader5` library, providing a clean interface for interacting with the MT5 terminal.
- **`app/domain/`**: Defines the core data structures and business rules of the application.

### Strategy

The trading strategy is implemented within the `app/domain/strategy.py` file. It uses a combination of technical indicators, including the 200-period Exponential Moving Average (EMA) and the MACD histogram, to identify trading opportunities. The core logic looks for specific patterns in candlestick formations and indicator values to generate buy or sell signals.
